# Auto Scaling configuration
# Scales based on CPU utilization
# IMPORTANT: Keep MinSize at 1 to prevent deployment failures
# During deployment, one instance updates while the other handles traffic

option_settings:
  # Auto Scaling Group
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 3
    Cooldown: 360  # 6 minutes between scaling activities

  # Deployment configuration
  # Rolling updates allow one instance to deploy while another serves traffic
  aws:elasticbeanstalk:command:
    DeploymentPolicy: RollingWithAdditionalBatch
    BatchSizeType: Percentage
    BatchSize: 25
    Timeout: 600

  # Rolling update policy - adds pause between batches for health stabilization
  aws:autoscaling:updatepolicy:rollingupdate:
    RollingUpdateEnabled: true
    RollingUpdateType: Health
    MinInstancesInService: 1
    MaxBatchSize: 1
    PauseTime: PT2M  # Pause 2 minutes between batches for health checks to stabilize
