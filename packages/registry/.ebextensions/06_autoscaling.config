# Auto Scaling configuration
# Scales based on CPU utilization
# IMPORTANT: Keep MinSize at 1 to prevent deployment failures
# During deployment, one instance updates while the other handles traffic

option_settings:
  # Auto Scaling Group
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 3
    Cooldown: 360  # 6 minutes between scaling activities

  # Deployment configuration
  # Rolling updates allow one instance to deploy while another serves traffic
  aws:elasticbeanstalk:command:
    DeploymentPolicy: Rolling
    BatchSizeType: Fixed
    BatchSize: 1
    HealthCheckSuccessThreshold: Warning
    Timeout: "600"  # 10 minutes for deployment to complete

  # Scaling triggers
  aws:autoscaling:trigger:
    MeasureName: CPUUtilization
    Statistic: Average
    Unit: Percent
    UpperThreshold: 70
    UpperBreachScaleIncrement: 1
    LowerThreshold: 30
    LowerBreachScaleIncrement: -1
    BreachDuration: 5  # Minutes

  # Launch configuration
  aws:autoscaling:launchconfiguration:
    MonitoringInterval: "1 minute"
