# Run database migrations on deployment
# Only runs on the leader instance to avoid race conditions
# Environment variables from Beanstalk (DATABASE_URL, etc.) are automatically available

container_commands:
  01_run_migrations:
    command: "npm run migrate"
    leader_only: true
    # DATABASE_URL is already available from Beanstalk environment

  02_verify_schema:
    command: |
      echo "Verifying database schema..."
      echo "Database: ${DATABASE_URL%%@*}@..." # Print DB connection (without password)
      if command -v psql &> /dev/null; then
        psql "$DATABASE_URL" -c "\dt" || echo "Could not verify schema"
      else
        echo "psql not available, skipping verification"
      fi
    leader_only: true
    ignoreErrors: true
