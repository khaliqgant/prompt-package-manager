# Run database migrations on deployment
# Only runs on the leader instance to avoid race conditions
# Note: npm install and build are handled automatically by Elastic Beanstalk
# via the postinstall script in package.json

container_commands:
  01_run_migrations:
    command: "npm run migrate"
    leader_only: true
    env:
      DATABASE_URL: $DATABASE_URL

  02_verify_schema:
    command: |
      echo "Verifying database schema..."
      psql $DATABASE_URL -c "\dt" || echo "Could not verify schema"
    leader_only: true
    ignoreErrors: true
