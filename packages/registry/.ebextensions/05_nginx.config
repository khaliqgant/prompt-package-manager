# Nginx reverse proxy configuration

files:
  "/etc/nginx/conf.d/custom.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Increase upload size for package uploads
      client_max_body_size 50M;

      # Timeouts
      proxy_connect_timeout 600;
      proxy_send_timeout 600;
      proxy_read_timeout 600;
      send_timeout 600;

      # Gzip compression
      gzip on;
      gzip_comp_level 4;
      gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

  "/etc/nginx/conf.d/https-redirect.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Redirect HTTP to HTTPS (if using custom domain with SSL)
      # Uncomment when SSL certificate is configured
      # server {
      #   listen 80;
      #   return 301 https://$host$request_uri;
      # }

container_commands:
  01_reload_nginx:
    command: "sudo service nginx reload"
    ignoreErrors: true
